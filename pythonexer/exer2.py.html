<html>
<head>
<title>exer2.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6a8759;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
exer2.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">random</span>
<span class="s0">import </span><span class="s1">string</span>

<span class="s2">#python第二次作业，修饰器 在datasampling合理封装的情况下 修饰</span>
<span class="s2"># 假装有四种方法 写四种不同的修饰函数 或类 达到修饰的目的</span>
<span class="s2"># 重点考察用带参数的修饰器  修饰器本身带参数</span>
<span class="s2"># 或者啥都不给也可以运行</span>
<span class="s2"># 一个修饰器 提供四种方法去修饰datasampling</span>
<span class="s2">#（求和求平均值）带参 给那种组合都要能运行</span>
<span class="s0">def </span><span class="s1">structDataSampling(**kwargs):</span>
    <span class="s1">result = list()</span>
    <span class="s0">for </span><span class="s1">index </span><span class="s0">in </span><span class="s1">range(kwargs[</span><span class="s3">'num'</span><span class="s1">]):</span>
        <span class="s1">element = list()</span>
        <span class="s0">for </span><span class="s1">key</span><span class="s0">, </span><span class="s1">value </span><span class="s0">in </span><span class="s1">kwargs[</span><span class="s3">'struct'</span><span class="s1">].items():</span>
            <span class="s0">if </span><span class="s1">key == int:</span>
                <span class="s1">it = iter(value[</span><span class="s3">'datarange'</span><span class="s1">])</span>
                <span class="s1">tmp = random.randint(next(it)</span><span class="s0">, </span><span class="s1">next(it))</span>
            <span class="s0">elif </span><span class="s1">key == float:</span>
                <span class="s1">it = iter(value[</span><span class="s3">'datarange'</span><span class="s1">])</span>
                <span class="s1">tmp = random.uniform(next(it)</span><span class="s0">, </span><span class="s1">next(it))</span>
            <span class="s0">elif </span><span class="s1">key == str:</span>
                <span class="s1">tmp = </span><span class="s3">''</span><span class="s1">.join(random.SystemRandom().choice(value[</span><span class="s3">'datarange'</span><span class="s1">]) </span><span class="s0">for </span><span class="s1">_ </span><span class="s0">in </span><span class="s1">range(value[</span><span class="s3">'len'</span><span class="s1">]))</span>
            <span class="s0">else</span><span class="s1">:</span>
                <span class="s0">break</span>
            <span class="s1">element.append(tmp)</span>
        <span class="s1">result.append(element)</span>
    <span class="s0">return </span><span class="s1">result</span>


<span class="s0">def </span><span class="s1">Calculation(*decargs):</span>
    <span class="s0">def </span><span class="s1">decorator(func):</span>
        <span class="s0">def </span><span class="s1">wrapper(*args</span><span class="s0">, </span><span class="s1">**kwargs):</span>
            <span class="s1">result = func(*args</span><span class="s0">, </span><span class="s1">**kwargs)</span>
            <span class="s1">mean = </span><span class="s4">0</span>
            <span class="s1">total = </span><span class="s4">0</span>
            <span class="s0">for </span><span class="s1">row </span><span class="s0">in </span><span class="s1">result:</span>
                <span class="s0">for </span><span class="s1">element </span><span class="s0">in </span><span class="s1">row:</span>
                    <span class="s0">if </span><span class="s1">isinstance(element</span><span class="s0">, </span><span class="s1">(int</span><span class="s0">, </span><span class="s1">float)):</span>
                        <span class="s1">total += element</span>
                        <span class="s1">mean += </span><span class="s4">1</span>
            <span class="s1">mean = total / mean</span>
            <span class="s0">if </span><span class="s3">'SUM' </span><span class="s0">in </span><span class="s1">decargs:</span>
                <span class="s1">print(</span><span class="s3">f&quot;The sum of the numbers is </span><span class="s0">{</span><span class="s1">total</span><span class="s0">:</span><span class="s3">.3f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)</span>
            <span class="s0">if </span><span class="s3">'AVG' </span><span class="s0">in </span><span class="s1">decargs:</span>
                <span class="s1">print(</span><span class="s3">f&quot;The mean of the numbers is </span><span class="s0">{</span><span class="s1">mean</span><span class="s0">:</span><span class="s3">.3f</span><span class="s0">}</span><span class="s3">&quot;</span><span class="s1">)</span>
            <span class="s0">return </span><span class="s1">result</span>

        <span class="s0">return </span><span class="s1">wrapper</span>

    <span class="s0">return </span><span class="s1">decorator</span>


<span class="s1">@Calculation()</span>
<span class="s0">def </span><span class="s1">structDataSamplingRes1(**kwargs):</span>
    <span class="s0">return </span><span class="s1">structDataSampling(**kwargs)</span>


<span class="s1">@Calculation(</span><span class="s3">'SUM'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">structDataSamplingRes2(**kwargs):</span>
    <span class="s0">return </span><span class="s1">structDataSampling(**kwargs)</span>


<span class="s1">@Calculation(</span><span class="s3">'AVG'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">structDataSamplingRes3(**kwargs):</span>
    <span class="s0">return </span><span class="s1">structDataSampling(**kwargs)</span>

<span class="s1">@Calculation(</span><span class="s3">'SUM'</span><span class="s0">, </span><span class="s3">'AVG'</span><span class="s1">)</span>
<span class="s0">def </span><span class="s1">structDataSamplingRes4(**kwargs):</span>
    <span class="s0">return </span><span class="s1">structDataSampling(**kwargs)</span>

<span class="s1">para = {</span><span class="s3">&quot;num&quot;</span><span class="s1">: </span><span class="s4">3</span><span class="s0">,</span>
        <span class="s3">&quot;struct&quot;</span><span class="s1">: {</span>
            <span class="s1">int: {</span><span class="s3">&quot;datarange&quot;</span><span class="s1">: [</span><span class="s4">1</span><span class="s0">, </span><span class="s4">10</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">float: {</span><span class="s3">&quot;datarange&quot;</span><span class="s1">: [</span><span class="s4">1.0</span><span class="s0">, </span><span class="s4">10.0</span><span class="s1">]}</span><span class="s0">,</span>
            <span class="s1">str: {</span><span class="s3">&quot;datarange&quot;</span><span class="s1">: string.ascii_letters</span><span class="s0">, </span><span class="s3">&quot;len&quot;</span><span class="s1">: </span><span class="s4">10</span><span class="s1">}</span>
        <span class="s1">}</span>
        <span class="s1">}</span>
<span class="s1">print(</span><span class="s3">&quot;修饰器参数0个，不实现任何操作。&quot;</span><span class="s1">)</span>
<span class="s1">result1 = structDataSamplingRes1(**para)</span>
<span class="s1">print(str(result1) + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s1">print(</span><span class="s3">&quot;修饰器参数1个，实现SUM求和操作：&quot;</span><span class="s1">)</span>
<span class="s1">result2 = structDataSamplingRes2(**para)</span>
<span class="s1">print(str(result2) + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s1">print(</span><span class="s3">&quot;修饰器参数1个，实现AVG求平均值操作：&quot;</span><span class="s1">)</span>
<span class="s1">result3 = structDataSamplingRes3(**para)</span>
<span class="s1">print(str(result3) + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)</span>

<span class="s1">print(</span><span class="s3">&quot;修饰器参数2个，同时实现SUM和AVG操作：&quot;</span><span class="s1">)</span>
<span class="s1">result4 = structDataSamplingRes4(**para)</span>
<span class="s1">print(str(result4) + </span><span class="s3">&quot;</span><span class="s0">\n</span><span class="s3">&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>